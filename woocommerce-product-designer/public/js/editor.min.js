var WPD_EDITOR=function(t,e){"use strict";var e={};return e.canvas={},e.serialized_parts={},e.final_canvas_parts={},e.selected_part=-1,e.canvasManipulationsPosition=[],e.box_center_x=!1,e.box_center_y=!1,e.arr_filters=["grayscale","invert","remove-white","sepia","sepia2","brightness","noise","gradient-transparency","pixelate","blur","convolute"],t(document).ready(function(){function a(){var e=t("#wpc-editor-container").outerWidth(),a=0,n=0;return 1==wpd.responsive&&wpd.canvas_w>e?(a=e,n=a*wpd.canvas_h/wpd.canvas_w):(a=wpd.canvas_w,n=wpd.canvas_h),[a,n]}function n(){e.canvas.forEachObject(function(t){"image"===t.type&&t.filters.length&&t.applyFilters(function(){t.canvas.renderAll()})})}function c(){var t=a();e.canvas=new fabric.Canvas("wpc-editor",{width:t[0],height:t[1]}),e.canvas.backgroundImageStretch=!1,i(),e.canvas.renderAll(),r()}function i(){var t=a();if(e.canvas.clipTo=null,wpd.clip_w&&wpd.clip_h&&wpd.clip_w>0&&wpd.clip_h>0&&"rect"==wpd.clip_type){var n=(t[0]-wpd.clip_w)/2;(wpd.clip_x||"0"==wpd.clip_x)&&(n=wpd.clip_x,e.box_center_x=n+wpd.clip_w/2);var c=(t[1]-wpd.clip_h)/2;(wpd.clip_y||"0"==wpd.clip_y)&&(c=wpd.clip_y,e.box_center_y=c+wpd.clip_h/2),e.canvas.clipTo=function(t){("rect"==wpd.clip_type||""==wpd.clip_type)&&(wpd.clip_rr>0?O(t,n,c,parseFloat(wpd.clip_w),parseFloat(wpd.clip_h),parseFloat(wpd.clip_rr),"",wpd.clip_border):(t.rect(n,c,wpd.clip_w,wpd.clip_h),wpd.clip_border&&(t.strokeStyle=wpd.clip_border,t.stroke())))}}else if(wpd.clip_r&&wpd.clip_r>0&&"arc"==wpd.clip_type){var n=wpd.canvas_w/2;wpd.clip_x&&(n=wpd.clip_x);var c=t[1]-wpd.clip_h/2;wpd.clip_y&&(c=wpd.clip_y),e.canvas.clipTo=function(t){t.arc(n,c,wpd.clip_r,0,2*Math.PI),wpd.clip_border&&(t.strokeStyle=wpd.clip_border,t.stroke())}}}function r(){e.canvas.on("object:selected",function(e){if(t("#cb-curved").removeAttr("checked"),e.target){var a=e.target.type,n=["rect","circle","triangle","polygon","path"];if("i-text"==a){T.openPanel("text-panel"),t("#font-family-selector").val(e.target.get("fontFamily")),t("#font-size-selector").val(e.target.get("fontSize")),t("#txt-color-selector").css("background-color",e.target.get("fill")),t("#txt-bg-color-selector").css("background-color",e.target.get("backgroundColor")),t("#new-text").val(e.target.get("text")),t(".txt-align[value='"+e.target.get("textAlign")+"']").attr("checked","checked"),t(".txt-decoration[value='"+e.target.get("textDecoration")+"']").attr("checked","checked");var c=e.target.get("fontWeight");"bold"==c?t("#bold-cb").attr("checked","checked"):t("#bold-cb").removeAttr("checked");var i=e.target.get("fontStyle");"italic"==i?t("#italic-cb").attr("checked","checked"):t("#italic-cb").removeAttr("checked"),0!=e.target.get("stroke")&&null!=e.target.getStroke()?(t("#txt-outline-color-selector").css("background-color",e.target.get("stroke")),t("#o-thickness-slider").val(e.target.get("strokeWidth"))):t("#o-thickness-slider").val(0);var r=e.target.opacity;t("#opacity-slider").val(r)}else if("group"==a){if(e.target.get("originalText")){t("#cb-curved").attr("checked","checked"),T.openPanel("text-panel"),t("#font-family-selector").val(e.target.item(0).get("fontFamily")).trigger("change"),t("#font-size-selector").val(e.target.item(0).get("fontSize")),t("#txt-color-selector").css("background-color",e.target.item(0).get("fill")),t("#txt-bg-color-selector").css("background-color",e.target.item(0).get("backgroundColor")),t("#new-text").val(e.target.get("originalText")),t("#curved-txt-radius-slider").val(e.target.get("radius")),t("#curved-txt-spacing-slider").val(e.target.get("spacing")),t(".txt-align[value='"+e.target.item(0).get("textAlign")+"']").attr("checked","checked"),t(".txt-decoration[value='"+e.target.item(0).get("textDecoration")+"']").attr("checked","checked");var c=e.target.item(0).get("fontWeight");"bold"==c?t("#bold-cb").attr("checked","checked"):t("#bold-cb").removeAttr("checked");var i=e.target.item(0).get("fontStyle");"italic"==i?t("#italic-cb").attr("checked","checked"):t("#italic-cb").removeAttr("checked"),0!=e.target.item(0).get("stroke")&&null!=e.target.item(0).getStroke()?(t("#txt-outline-color-selector").css("background-color",e.target.item(0).get("stroke")),t("#o-thickness-slider").val(e.target.item(0).get("strokeWidth"))):t("#o-thickness-slider").val(0);var r=e.target.item(0).opacity;t("#opacity-slider").val(r)}}else if(jQuery.inArray(a,n)>=0){var l=e.target.opacity;t("#shape-opacity-slider").val(l),t("#shape-bg-color-selector").css("background-color",e.target.get("fill")),t("#shape-outline-color-selector").css("background-color",e.target.get("stroke")),t("#shape-thickness-slider").val(e.target.get("strokeWidth")),T.openPanel("shapes-panel")}else if("image"==a){o(e);var s=e.target.filters;t("#img-effects input:checkbox").removeAttr("checked"),t.each(s,function(e,a){if(a){var n=a.type,c=a.matrix,i=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],r=[0,-1,0,-1,5,-1,0,-1,0],o=[1,1,1,1,.7,-1,-1,-1,-1];"Grayscale"==n?t(".acd-grayscale").attr("checked","checked"):"Invert"==n?t(".acd-invert").attr("checked","checked"):"Sepia"==n?t(".acd-sepia").attr("checked","checked"):"Sepia2"==n?t(".acd-sepia2").attr("checked","checked"):"Convolute"==n?0==t(c).not(i).length&&0==t(i).not(c).length?t(".acd-blur").attr("checked","checked"):0==t(c).not(r).length&&0==t(r).not(c).length?t(".acd-sharpen").attr("checked","checked"):0==t(c).not(o).length&&0==t(o).not(c).length&&t(".acd-emboss").attr("checked","checked"):console.log(n,c)}})}else if(("path"==a||"path-group"==a)&&"none"!=wpd.svg_colorization)if(T.openPanel("cliparts-panel"),t("#clipart-bg-color-container").html(""),e.target.isSameColor&&e.target.isSameColor()||!e.target.paths){var d="clipart-bg-1-color-selector",p='<span id="'+d+'" class="svg-color-selector" data-placement="top" data-original-title="'+wpd.translated_strings.svg_background_tooltip+'" style="background-color:'+e.target.get("fill")+'"></span>';t("#clipart-bg-color-container").append(p),t("[data-original-title]").tooltip(),h(d)}else if(e.target.paths)for(var v=[],u=0,g=0;g<e.target.paths.length;g++){var d="clipart-bg-"+u+"-color-selector",f=e.target.paths[g].fill,p='<span id="'+d+'" class="svg-color-selector" data-placement="top" data-original-title="'+wpd.translated_strings.svg_background_tooltip+'" style="background-color:'+f+'" data-index="'+g+'"></span>';if("by-colors"==wpd.svg_colorization){var _=jQuery.inArray(f,v);if(-1==_)t("#clipart-bg-color-container").append(p),t("[data-original-title]").tooltip(),h(d),v.push(f),u++;else{var b="#clipart-bg-"+_+"-color-selector",m=t(b).attr("data-index");t(b).attr("data-index",m+","+g)}}else t("#clipart-bg-color-container").append(p),t("[data-original-title]").tooltip(),h(d),u++}e.target.get("lockMovementX")?t("#lock-mvt-x").attr("checked","checked"):t("#lock-mvt-x").removeAttr("checked"),e.target.get("lockMovementY")?t("#lock-mvt-y").attr("checked","checked"):t("#lock-mvt-y").removeAttr("checked"),e.target.get("lockScalingX")?t("#lock-scl-x").attr("checked","checked"):t("#lock-scl-x").removeAttr("checked"),e.target.get("lockScalingY")?t("#lock-scl-y").attr("checked","checked"):t("#lock-scl-y").removeAttr("checked"),e.target.get("lockDeletion")?t("#lock-Deletion").attr("checked","checked"):t("#lock-Deletion").removeAttr("checked")}}),e.canvas.on("object:added",function(t){if(t.target){e.canvas.calcOffset(),e.canvas.renderAll(),t.target.setCoords();var a=t.target.type;"i-text"==a&&m(),e.canvas.calcOffset()}}),e.canvas.on("object:modified",function(t){e.canvas.calcOffset(),e.canvas.renderAll(),t.target.setCoords(),e.save_canvas()})}function o(e){var a=e.target.toObject(),n=a.src,c=t("#img-cliparts-accordion img[src='"+n+"']").length,i=t("#facebook-panel img[src='"+n+"']").length,r=t("#instagram-panel img[src='"+n+"']").length;c?T.openPanel("cliparts-panel"):i?T.openPanel("facebook-panel"):r?T.openPanel("instagram-panel"):T.openPanel("uploads-panel")}function l(t,a,n){"txt-color-selector"==t||"shape-bg-color-selector"==t||"clipart-bg-color-selector"==t?a.set("fill","#"+n):"txt-bg-color-selector"==t?a.set("backgroundColor","#"+n):"txt-outline-color-selector"==t||"shape-outline-color-selector"==t?a.set("stroke","#"+n):console.log("unknow color selector :#"+t),e.canvas.renderAll()}function s(){var a=t("#wpc-parts-bar > li").length,n={};t.each(t(".wpc-qty-container"),function(e,a){var c=t(this).find(".wpd-qty").val();n[t(this).data("id")]=c});var c={};t.each(t("#wpc-parts-bar > li"),function(i,r){var o=t(this).attr("data-id");if(e.serialized_parts[o]){var l={};l.json=e.serialized_parts[o][e.canvasManipulationsPosition[o]],c[o]=l}t(this).index()==a-1&&t.post(ajax_object.ajax_url,{action:"get_design_price",variations:n,serialized_parts:JSON.stringify(c)},function(a){if(e.is_json(a)){var n=JSON.parse(a);t.each(t(".wpc-qty-container"),function(e,a){var c=t(this).data("id"),i=n.prices[c],r=t(this).find(".wpd-qty");t(this).find(".total_order").text(i),r.attr("uprice",i),r.trigger("change")})}else t("#debug").html(a)})})}function d(a){var n=t("#wpc-parts-bar > li").first().data("id");if("object"==typeof a){var c=!1;t.each(a,function(a,i){t.each(i,function(t,i){if("json"==t){e.serialized_parts[a]=[],e.canvasManipulationsPosition[a]=0;var r=i;e.serialized_parts[a].push(r),a==n&&(c=!0,e.selected_part=0,e.canvas.loadFromJSON(r,function(){e.canvas.renderAll.bind(e.canvas),S()}),e.canvas.calcOffset(),p(),r.indexOf('{"type":"text"')>-1&&b())}})}),c?f(0):t("#wpc-parts-bar > li").first().click()}setTimeout(function(){e.canvas.renderAll()},500)}function p(){var e=t("#wpc-parts-bar > li").first().attr("data-url"),a="url('"+e+"') no-repeat center center";t("#wpc-editor-container").css("background",a)}function v(){"undefined"==typeof to_load&&t("#wpc-parts-bar > li").each(function(a){var n=t(this).attr("data-id");e.serialized_parts[n]=[],e.canvasManipulationsPosition[n]=-1;var c=t("#wpc-parts-bar > li").length;a==c-1&&g(wpd.output_loop_delay,u,function(){t("#wpc-parts-bar > li").first().click(),e.canvas.renderAll(),S(),t.unblockUI()})})}function u(e){t("#wpc-parts-bar > li:eq("+e+")").click()}function g(e,a,n){t.blockUI({message:wpd.translated_strings.loading_msg});var c=t("#wpc-parts-bar > li").length,i=0,r=setInterval(function(){t.isFunction(a)&&a(i),i==c-1?(window.clearInterval(r),t.isFunction(n)?setTimeout(function(){n()},e):t.unblockUI()):i++},e)}function f(a,n,c){var i=t("#wpc-parts-bar > li:eq("+a+")"),r=i.attr("data-ovni");"undefined"==typeof c&&(c=!1);var o=i.data("bg");""==o&&(o=null);var l=i.data("ov");""==l&&(l=null);var s=new Image;if(s.onload=function(){var t=e.get_img_best_fit_dimensions(s,wpd.canvas_w,wpd.canvas_h);e.canvas.setBackgroundImage(s.src,e.canvas.renderAll.bind(e.canvas),{left:wpd.canvas_w/2,top:wpd.canvas_h/2,originX:"center",originY:"center",width:t[0],height:t[1]})},null!=o?s.src=o:e.canvas.backgroundImage=null,"-1"==r&&c)e.canvas.overlayImage=null,e.canvas.renderAll.bind(e.canvas);else{var d=new Image;d.onload=function(){var t=e.get_img_best_fit_dimensions(d,wpd.canvas_w,wpd.canvas_h);e.canvas.setOverlayImage(d.src,e.canvas.renderAll.bind(e.canvas),{left:wpd.canvas_w/2,top:wpd.canvas_h/2,originX:"center",originY:"center",width:t[0],height:t[1]})},null!=l&&(d.src=l)}t.isFunction(n)&&setTimeout(function(){n(a)},200)}function h(a){var n=t("#"+a),c=n.data("index"),i=n.css("background-color");i||(i="#0000ff"),"custom"==wpd.palette_type?n.qtip({content:"<div class='wpc-custom-svg-colors-container' data-id='"+a+"' data-index='"+c+"'>"+wpd.palette_tpl+"</div>",position:{corner:{target:"middleRight",tooltip:"leftTop"}},style:{width:200,padding:5,background:"white",color:"black",border:{width:1,radius:1,color:"#08AED6"}},tip:"bottomLeft",show:"click",hide:{when:{event:"unfocus"}}}):n.ColorPicker({color:i,onShow:function(e){return t(e).fadeIn(500),!1},onHide:function(a){t(a).fadeOut(500);var n=e.canvas.getActiveObject();return null!=n&&e.save_canvas(),!1},onChange:function(t,e,n){_(a,e,c)}})}function _(a,n,c){t("#"+a).css("background-color","#"+n);var i=e.canvas.getActiveObject();if(null!=i&&("path"==i.type||"path-group"==i.type)){if(i.isSameColor&&i.isSameColor()||!i.paths)i.set("fill","#"+n);else if(i.paths)if("by-colors"==wpd.svg_colorization){c=t("#"+a).attr("data-index");var r=c.split(",");t.each(r,function(t,e){i.paths[e].setFill("#"+n)})}else i.paths[c].setFill("#"+n);e.canvas.renderAll()}}function b(){var a=["active","angle","backgroundColor","clipTo","currentHeight","currentWidth","fill","currentWidth","flipX","flipY","fontFamily","fontSize","fontStyle","fontWeight","height","left","lineHeight","originX","originY","scaleX","scaleY","shadow","text","textAlign","textBackgroundColor","textDecoration","top","width","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockUniScaling"];setTimeout(function(){var n=e.canvas.getObjects().map(function(t){return t});t.each(n,function(n,c){if("text"==c.type){var i=new fabric.IText("");t.each(a,function(t,e){i.set(e,c.get(e))}),e.canvas.remove(c),e.canvas.add(i)}}),e.canvas.renderAll.bind(e.canvas)},3600)}function m(){t("#new-text").val(""),t(".txt-align").removeAttr("checked"),t(".txt-decoration").removeAttr("checked"),t("#bold-cb").removeAttr("checked"),t("#italic-cb").removeAttr("checked"),t("#font-family-selector").val(t("#font-family-selector option:first").val()).trigger("change"),t("#o-thickness-slider").val(t("#o-thickness-slider option:first").val()),t("#opacity-slider").val(1)}function w(t){k(t,!1)}function k(a,c){e.selected_part=a,c="undefined"!=typeof c?c:!0;var i=t("#wpc-parts-bar > li:eq("+a+")").attr("data-id"),r=t("#wpc-parts-bar > li:eq("+a+")").attr("data-url");e.canvas.clear(),"undefined"==typeof e.serialized_parts[i]&&(e.serialized_parts[i]=["{}"]),e.canvas.loadFromJSON(e.serialized_parts[i][e.canvasManipulationsPosition[i]],function(){n(),f(e.selected_part,function(){var a=wpd.output_w/e.canvas.getWidth();c&&(a=1);var o=e.canvas.toDataURL({format:"png",multiplier:a,quality:1}),l="";wpd.generate_svg&&(l=e.canvas.toSVG());var s=y(o);if(c){var d="";if(wpd.watermark){var p=new FormData;p.append("action","get_watermarked_preview"),p.append("watermark",wpd.watermark),p.append("image",s),t.ajax({type:"POST",url:ajax_object.ajax_url,data:p,processData:!1,contentType:!1}).done(function(a){if(e.is_json(a)){var n=JSON.parse(a);d=r?"<div style='background-image:url("+r+");'><img src='"+n.url+"'></div>":"<div><img src='"+n.url+"'></div>",t("#wpd-modal .modal-body").append(d)}else t("#debug").html(a)})}else d=r?"<div style='background-image:url("+r+");'><img src='"+o+"'></div>":"<div><img src='"+o+"'></div>",t("#wpd-modal .modal-body").append(d)}else{var v=t.parseJSON(e.serialized_parts[i][e.canvasManipulationsPosition[i]]),u=[];if(wpd.print_layers){var g=v.objects;t.each(g,function(t,a){e.canvas.clear();var c=v;c.objects=[a];var r=JSON.stringify(c);e.canvas.loadFromJSON(r,function(){n(),e.canvas.renderAll.bind(e.canvas),f(e.selected_part,"",!0);var a=wpd.output_w/e.canvas.getWidth(),c=e.canvas.toDataURL({format:"png",multiplier:a,quality:1}),r=y(c);u.push(r),t==g.length-1&&(e.canvas.loadFromJSON(e.serialized_parts[i][e.canvasManipulationsPosition[i]]),n())})})}e.final_canvas_parts[i]={json:e.serialized_parts[i][e.canvasManipulationsPosition[i]],image:s,original_part_img:r,layers:u,svg:l}}f(e.selected_part)},!0)})}function y(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var a=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),c=0;c<e.length;c++)n[c]=e.charCodeAt(c);var i=new Blob([n],{type:a});return i}function x(a){return t.each(e.final_canvas_parts,function(e,n){t.each(n,function(n,c){"image"==n?a.append(e+"["+n+"]",c):"layers"==n?t.each(c,function(t,n){a.append("layers["+e+"][]",n)}):a.append("final_canvas_parts["+e+"]["+n+"]",c)})}),a}function j(){var a=t("#wpc-parts-bar > li:eq(0)").attr("data-id");e.canvas.clear(),e.canvas.loadFromJSON(e.serialized_parts[a][e.canvasManipulationsPosition[a]],function(){e.canvas.renderAll.bind(e.canvas),S()})}function S(){if(1!=wpd.responsive)return!1;var t=a(),c=t[0]/wpd.canvas_w;1!=c&&(e.canvas.setWidth(t[0]),e.canvas.setHeight(t[1]),e.canvas.setZoom(c),e.canvas.calcOffset(),e.canvas.renderAll()),n()}function A(){t(".canvas-container").hide(),S(),i(),t(".canvas-container").show()}function O(t,e,a,n,c,i,r,o){"undefined"==typeof o&&(o=!1),"undefined"==typeof i&&(i=5),t.beginPath(),t.moveTo(e+i,a),t.lineTo(e+n-i,a),t.quadraticCurveTo(e+n,a,e+n,a+i),t.lineTo(e+n,a+c-i),t.quadraticCurveTo(e+n,a+c,e+n-i,a+c),t.lineTo(e+i,a+c),t.quadraticCurveTo(e,a+c,e,a+c-i),t.lineTo(e,a+i),t.quadraticCurveTo(e,a,e+i,a),t.closePath(),o&&(t.strokeStyle=o,t.stroke()),r&&t.fill()}var P,T=new Spry.Widget.Accordion("wpc-tools-box-container",{useFixedPanelHeights:!1,defaultPanel:-1});new Spry.Widget.Accordion("img-cliparts-accordion",{useFixedPanelHeights:!1,defaultPanel:-1}),new Spry.Widget.Accordion("my-designs-accordion",{useFixedPanelHeights:!1,defaultPanel:-1}),t("[data-original-title]").tooltip(),c(),v(),t(document).on("click","#wpc-parts-bar > li",function(a){var n=t(this).attr("data-url");if(e.selected_part!=t(this).index()){if(f(t(this).index()),t("#wpc-parts-bar > li").removeClass("active"),t(this).addClass("active"),e.selected_part>=0&&(e.save_canvas(),e.canvas.clear()),e.selected_part=t(this).index(),n){var c="url('"+n+"') no-repeat center center";t("#wpc-editor-container").css("background",c)}else t("#wpc-editor-container").css("background","none");var i=t(this).attr("data-id");"undefined"==typeof e.serialized_parts[i]&&(e.serialized_parts[i]=[],e.canvasManipulationsPosition[i]=-1),e.serialized_parts[i][e.canvasManipulationsPosition[i]]&&(t.blockUI({message:wpd.translated_strings.loading_msg}),e.canvas.loadFromJSON(e.serialized_parts[i][e.canvasManipulationsPosition[i]],function(){S(),t.unblockUI()})),e.refresh_undo_redo_status()}}),"undefined"!=typeof to_load&&setTimeout(function(){d(to_load)},500),e.setCustomProperties=function(t){t.toObject=function(t){return function(){return fabric.util.object.extend(t.call(this),{lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,lockScalingX:this.lockScalingX,lockScalingY:this.lockScalingY,lockDeletion:this.lockDeletion,price:this.price,originalText:this.originalText,radius:this.radius,spacing:this.spacing})}}(t.toObject)},e.is_json=function(t){return/^[\],:{}\s]*$/.test(t.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?!0:!1},e.save_canvas=function(){var a=t("#wpc-parts-bar > li:eq("+e.selected_part+")").attr("data-id");"undefined"==typeof e.serialized_parts[a]&&(e.serialized_parts[a]=["{}"]);var n;for(n=e.canvasManipulationsPosition[a];n<=e.serialized_parts[a].length-2;n++)e.serialized_parts[a].pop();e.canvasManipulationsPosition[a]++;var c=JSON.stringify(e.canvas.toJSON(["lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","price","lockDeletion","originalText","radius","spacing"]));e.serialized_parts[a].push(c),s(),e.refresh_undo_redo_status()},e.centerObjectH=function(t){var e=t.getWidth(),a=(parseFloat(wpd.canvas_w)-e)/2;t.set("left",a)},e.centerObjectV=function(t){var e=t.getHeight(),a=(parseFloat(wpd.canvas_h)-e)/2;t.set("top",a)},e.centerObject=function(t){e.centerObjectV(t),e.centerObjectH(t)},e.change_item_color=function(a,n){t("#"+a).css("background-color","#"+n);var c=e.canvas.getActiveObject();null!=c&&"group"!=c.type?l(a,c,n):null!=c&&"group"==c.type&&c.forEachObject(function(t){l(a,t,n)})},e.refresh_undo_redo_status=function(){var a=t("#wpc-parts-bar > li:eq("+e.selected_part+")").attr("data-id");1==e.serialized_parts[a].length||0==e.canvasManipulationsPosition[a]?t("#undo-btn").addClass("disabled"):t("#undo-btn").removeClass("disabled"),e.serialized_parts[a].length>0&&e.canvasManipulationsPosition[a]<e.serialized_parts[a].length-1?t("#redo-btn").removeClass("disabled"):t("#redo-btn").addClass("disabled")},e.get_img_best_fit_dimensions=function(t,e,a){var n=t.width,c=t.height;if(e>n&&a>c)return[n,c];var i=n/c;return n=e,c=e/i,c>a&&(c=a,n=a*i),[n,c]},t(document).on("click",".wpc-custom-colors-container span",function(a){var n=t(this).parent().data("id"),c=t(this).data("color");e.change_item_color(n,c)}),t(document).on("click",".wpc-custom-svg-colors-container span",function(e){var a=t(this).parent().data("id"),n=t(this).parent().data("index"),c=t(this).data("color");_(a,c,n)}),t(document).on("touchstart click","#preview-btn",function(a){a.preventDefault(),t("#wpd-modal .modal-body").html(""),e.save_canvas(),g(wpd.output_loop_delay,k,function(){t("#wpc-parts-bar > li").first().click(),t("#wpd-modal").modal("show"),t.unblockUI()})}),t(document).on("click","#download-btn",function(){t("#debug").html(""),g(wpd.output_loop_delay,w,function(){if(jQuery.isEmptyObject(e.final_canvas_parts))t("#debug").html("<div class='wpc-failure'>"+wpd.translated_strings.empty_object_msg+"</div>"),t.unblockUI();else{var a=wpd.global_variation_id,n=new FormData;n.append("action","generate_downloadable_file"),n.append("variation_id",a),n=x(n),t.ajax({type:"POST",url:ajax_object.ajax_url,data:n,processData:!1,contentType:!1}).done(function(a){if(t.unblockUI(),e.is_json(a)){var n=JSON.parse(a);t("#wpc-parts-bar > li").length>1?t("#wpc-parts-bar > li").first().click():j(),t("#debug").html(n.message)}else t("#debug").html(a)})}})}),t(document).on("touchstart click","#save-btn",function(){g(wpd.output_loop_delay,w,function(){if(jQuery.isEmptyObject(e.final_canvas_parts))t("#debug").html("<div class='wpc-failure'>"+wpd.translated_strings.empty_object_msg+"</div>"),t.unblockUI();else{var a=(t("#wpd-qty").val(),t("#save-btn").data("index")),n=wpd.global_variation_id,c=new FormData;c.append("action","save_custom_design_for_later"),c.append("variation_id",n),c.append("design_index",a),c=x(c),t.ajax({type:"POST",url:ajax_object.ajax_url,data:c,processData:!1,contentType:!1}).done(function(a){if(t.unblockUI(),e.is_json(a)){var n=JSON.parse(a);t("#wpc-parts-bar > li").first().click(),a.is_logged?a.success&&t(location).attr("href",n.url):t(location).attr("href",n.url)}else t("#debug").html(a)})}})}),t(".wpd-delete-design").click(function(){var e=t(this).data("index"),a=wpd.global_variation_id;t(this);t.get(ajax_object.ajax_url,{action:"delete_saved_design",design_index:e,variation_id:a},function(e){e.success?t(location).attr("href",e.url):alert(e.message)},"json")}),t(document).on("click",".wpc-qty-container .plus, .wpc-qty-container .minus",function(){var e=t(this).siblings(".wpd-qty"),a=parseFloat(e.val()),n=parseFloat(e.attr("max")),c=parseFloat(e.attr("min")),i=e.attr("step");a&&""!==a&&"NaN"!==a||(a=0),(""===n||"NaN"===n)&&(n=""),(""===c||"NaN"===c)&&(c=0),("any"===i||""===i||void 0===i||"NaN"===parseFloat(i))&&(i=1),t(this).is(".plus")?n&&(n==a||a>n)?e.val(n):e.val(a+parseFloat(i)):c&&(c==a||c>a)?e.val(c):a>0&&e.val(a-parseFloat(i)),e.trigger("change"),s()}),t(".wpd-rp-attribute.cart-item-edit").click(function(){return confirm(wpd.translated_strings.cart_item_edition_switch)}),t(document).on("touchstart click",".wpd-rp-attribute",function(a){a.preventDefault();var n={},c=t(this).attr("href");t.each(e.serialized_parts,function(t,e){n[t]=e[e.length-1]});var i=JSON.stringify(n);t.post(ajax_object.ajax_url,{action:"save_data_to_reload",serialized_parts:i},function(a){e.is_json(a)?t(location).attr("href",c):t("#debug").html(a)})}),t(document).on("change",".wpd-qty",function(){var e=t(this).val(),a=t(this).attr("uprice"),n=t(this).attr("opt_price"),c=t(this).siblings(".total-price").find(".total_order");if(!t.isNumeric(e))return t(this).val(1),void c.html(a);t.isNumeric(n)&&(a=parseFloat(a)+parseFloat(n));var i=a*e;c.html(t.number(i,wpd.nb_decimals,wpd.decimal_sep,wpd.thousand_sep))}),t(document).on("touchstart click","#add-to-cart-btn",function(){t("#debug").html("");var a={};t.each(t(".wpc-qty-container"),function(e,n){var c=t(this).find(".wpd-qty").val();a[t(this).data("id")]=c}),e.save_canvas(),g(wpd.output_loop_delay,w,function(){if(jQuery.isEmptyObject(e.final_canvas_parts))t("#debug").html("<div class='wpc-failure'>"+wpd.translated_strings.empty_object_msg+"</div>"),t.unblockUI();else{var n=t("#wpd-qty").val(),c=wpd.global_variation_id,i=wpd.query_vars.edit;"undefined"==typeof i&&(i="");var r=new FormData;if(r.append("variation_id",c),r.append("variations",JSON.stringify(a)),r.append("action","add_custom_design_to_cart"),r.append("cart_item_key",i),r.append("final_canvas_parts",e.final_canvas_parts),r.append("quantity",n),t(".ninja-forms-form").length>0){var o=JSON.stringify(get_design_options());r.append("wpd-design-opt",o)}r=x(r),t.ajax({type:"POST",url:ajax_object.ajax_url,data:r,processData:!1,contentType:!1}).done(function(a){if(e.is_json(a)){var n=JSON.parse(a);t("#wpc-parts-bar > li").length>1?t("#wpc-parts-bar > li").first().click():j(),1==wpd.redirect_after&&n.success?t(location).attr("href",n.url):(t("#debug").html(n.message),t.unblockUI())}else t("#debug").html(a),t.unblockUI()})}})}),t("#lock-mvt-x, #lock-mvt-y, #lock-scl-x, #lock-scl-y, #lock-Deletion").change(function(a){var n=t(this).data("property"),c=e.canvas.getActiveObject(),i=e.canvas.getActiveGroup();null!=c?(t(this).is(":checked")?c[n]=!0:c[n]=!1,e.save_canvas()):null!=i&&(t(this).is(":checked")?i[n]=!0:i[n]=!1,e.save_canvas())}),t(".post-type-wpc-template #publish").click(function(a){a.preventDefault(),g(wpd.output_loop_delay,w,function(){if(jQuery.isEmptyObject(e.final_canvas_parts))alert(wpd.translated_strings.empty_object_msg),t.unblockUI();else{var a=new FormData;a.append("action","save_canvas_to_session"),a=x(a),t.ajax({type:"POST",url:ajax_object.ajax_url,data:a,processData:!1,contentType:!1}).done(function(e){t("#post").submit()})}})}),t(window).resize(function(){clearTimeout(P),P=setTimeout(A,500)}),t(document).keydown(function(a){var n=e.canvas.getActiveObject(),c=e.canvas.getActiveGroup();46==a.which?t("#delete_btn").click():37==a.which?null==c||c.get("lockMovementX")?null==n||n.get("lockMovementX")||(n.set("left",n.left-1),e.canvas.renderAll(),e.save_canvas()):(c.set("left",c.left-1),e.canvas.renderAll(),e.save_canvas()):39==a.which?null==c||c.get("lockMovementX")?null==n||n.get("lockMovementX")||(n.set("left",n.left+1),e.canvas.renderAll(),e.save_canvas()):(c.set("left",c.left+1),e.canvas.renderAll(),e.save_canvas()):38==a.which?null==c||c.get("lockMovementY")?null==n||n.get("lockMovementY")||(a.preventDefault(),n.set("top",n.top-1),e.canvas.renderAll(),e.save_canvas()):(a.preventDefault(),c.set("top",c.top-1),e.canvas.renderAll(),e.save_canvas()):40==a.which?null==c||c.get("lockMovementY")?null==n||n.get("lockMovementY")||(a.preventDefault(),n.set("top",n.top+1),e.canvas.renderAll(),e.save_canvas()):(a.preventDefault(),c.set("top",c.top+1),e.canvas.renderAll(),e.save_canvas()):67==a.keyCode&&a.ctrlKey?t("#copy_paste_btn").click():90==a.keyCode&&a.ctrlKey?t("#undo-btn").click():89==a.keyCode&&a.ctrlKey&&t("#redo-btn").click()}),t(".wpd-rp-attribute").mouseenter(function(){t("#wpd-rp-desc").html(t(this).data("desc"))}),t(".wpd-rp-attribute").mouseout(function(){var e=t(".wpd-rp-attribute.selected").data("desc");t("#wpd-rp-desc").html(e)}),t("canvas").bind("contextmenu",function(t){return!1})}),e}(jQuery,WPD_EDITOR);